(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();const I="/api/curevia-chat";var f,w;const S=((w=(f=self.crypto)==null?void 0:f.randomUUID)==null?void 0:w.call(f))||"sess-"+Date.now();function a(t,o={},...r){const i=document.createElement(t);for(const[e,n]of Object.entries(o||{}))e==="class"?i.className=n:e==="html"?i.innerHTML=n:i.setAttribute(e,n);for(const e of r)e&&i.appendChild(typeof e=="string"?document.createTextNode(e):e);return i}const N=document.getElementById("app"),T=a("div",{class:"wrap",role:"main"}),j=a("h3",{role:"heading","aria-level":"1"},a("span",{id:"title"},"Curevia Assistant"),a("div",{style:"display:flex; gap:8px; align-items:center"},(()=>{const t=a("select",{id:"lang",class:"toggle","aria-label":"Language selector"});return t.innerHTML='<option value="sv">Svenska</option><option value="en">English</option><option value="no">Norsk</option><option value="da">Dansk</option>',t})(),a("button",{id:"dark",class:"toggle",type:"button","aria-pressed":"false","aria-label":"VÃ¤xla mÃ¶rkt lÃ¤ge"},"MÃ¶rkt lÃ¤ge"))),g=a("div",{id:"log","aria-live":"polite","aria-atomic":"false"}),A=a("div",{class:"row",role:"form","aria-label":"Chat input"},a("input",{id:"inp",type:"text",placeholder:"Skriv ett meddelande...",autocomplete:"off","aria-label":"Skriv ett meddelande"}),a("button",{id:"btn",class:"primary",type:"button"},"Skicka"));T.append(j,g,A);N.appendChild(T);const L=document.createElement("style");L.textContent=`
  #log{ max-height:70vh; overflow:auto; padding-bottom:8px }
  .bubble{ padding:10px 12px; border-radius:16px; margin:8px 0; max-width:90%; white-space:pre-wrap; line-height:1.35; position:relative }
  .bot{ background:#eef2ff; border-top-left-radius:6px }
  .me{ background:#2563eb; color:#fff; margin-left:auto; border-top-right-radius:6px }
  .row{ display:flex; gap:8px; position:sticky; bottom:0; background:var(--bg); padding:8px 0; border-top:1px solid var(--border) }
  input[type="text"]{ flex:1; padding:12px; border:1px solid var(--border); border-radius:12px }
  button.primary{ padding:12px 16px; border:0; border-radius:12px; background:#111827; color:#fff; cursor:pointer }
`;document.head.appendChild(L);function m(t,o="bot"){const r=a("div",{class:"bubble "+(o==="me"?"me":"bot")});return t&&(r.innerText=t),g.appendChild(r),g.scrollTop=g.scrollHeight,r}function P(){const t=m("â€¦","bot");return{destroy(){try{t.remove()}catch{}}}}m("Hej! ðŸ‘‹ VÃ¤lkommen till Curevia. Vad vill du gÃ¶ra?");const p=document.getElementById("inp"),B=document.getElementById("btn");B.onclick=()=>O(p.value);p.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),p.value.trim()&&O(p.value))});async function O(t){if(!t||!t.trim())return;m(t,"me"),p.value="";const o=m("","bot"),r=P();try{const i=await fetch(I+"?stream=1",{method:"POST",headers:{"Content-Type":"application/json","X-Session-Id":S,"X-Lang":navigator.language||"",Accept:"text/event-stream"},body:JSON.stringify({message:t})}),e=(i.headers.get("content-type")||"").toLowerCase();if(!e.includes("text/event-stream")){if(r.destroy(),e.includes("application/json")){const y=await i.json();o.innerText=y.reply||"Tekniskt fel â€“ prova igen."}else o.innerText="Tekniskt fel â€“ prova igen.";return}const n=i.body.getReader(),d=new TextDecoder("utf-8");let c="",b=!1,x="";for(;;){const{value:k,done:y}=await n.read();if(y)break;c+=d.decode(k,{stream:!0});let v;for(;(v=c.indexOf(`

`))>=0;){const C=c.slice(0,v);c=c.slice(v+2);const E=C.split(/\r?\n/);let h="message",l="";for(const s of E)if(s){if(s.startsWith("event:"))h=s.slice(6).trim();else if(s.startsWith("data:")){let u=s.slice(5);u.startsWith(" ")&&(u=u.slice(1)),l+=u}}if(l&&(h==="token"&&(b||(r.destroy(),b=!0),o.innerText+=l,x+=l),h==="final")){r.destroy();try{const s=JSON.parse(l);o.innerText=s.reply||x||" "}catch{b||(o.innerText=l)}}}}o.innerText||(r.destroy(),o.innerText="Inget svar â€“ prova igen.")}catch{r.destroy(),o.innerText="Tekniskt fel â€“ prova igen."}}
